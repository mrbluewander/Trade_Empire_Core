<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Trade Empire Core - çµ±å¸¥æŒ‡æ®ä¸­å¿ƒ</title>
    <style>
        body { background-color: #1a1a2e; color: #e94560; font-family: sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; border: 2px solid #0f3460; padding: 20px; border-radius: 15px; background: #16213e; }
        #log-output { background: #000; color: #00ff00; padding: 15px; height: 350px; overflow-y: auto; font-family: monospace; border: 1px solid #333; margin-top: 20px; white-space: pre-wrap; }
        button { padding: 10px 20px; background: #e94560; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; font-weight: bold; }
        input { width: 60%; padding: 10px; background: #1a1a2e; color: white; border: 1px solid #4ecca3; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align:center; color:#4ecca3;">ğŸ›ï¸ çµ±å¸¥æŒ‡æ®ä¸­å¿ƒ (æ ¸å¿ƒè‡ªç™’ç‰ˆ)</h1>
        <div style="text-align:center; margin-bottom: 20px;">
            <input type="password" id="api-key" placeholder="è¼¸å…¥ Gemini API Key...">
            <button onclick="saveKey()">è¨­å®š API Key</button>
        </div>
        <div style="text-align:center;">
            <button style="background:#4ecca3;" onclick="smartConnect()">âš¡ æ™ºèƒ½æƒæé€£ç·š</button>
        </div>
        <div id="log-output">ç­‰å¾…çµ±å¸¥æŒ‡ä»¤...</div>
    </div>

    <script>
        function log(msg, color='#00ff00') {
            const out = document.getElementById('log-output');
            out.innerHTML += `\n[${new Date().toLocaleTimeString()}] <span style="color:${color}">${msg}</span>`;
            out.scrollTop = out.scrollHeight;
        }

        function saveKey() {
            const key = document.getElementById('api-key').value;
            if(key) { localStorage.setItem('trade_key', key); log("API Key å„²å­˜æˆåŠŸã€‚", "#4ecca3"); }
        }

        async function smartConnect() {
            const key = localStorage.getItem('trade_key');
            if(!key) return log("éŒ¯èª¤: è«‹å…ˆè¨­å®š API Key", "red");

            log("ğŸš€ å•Ÿå‹•æ™ºèƒ½æƒææ¨¡å¼... æ­£åœ¨åµæ¸¬æ‚¨çš„å¯ç”¨æ¨¡å‹...");
            
            // ç¬¬ä¸€æ­¥ï¼šå…ˆå• Google ä½ å®¶æœ‰å“ªäº›æ¨¡å‹å¯ä»¥ç”¨
            try {
                const listUrl = `https://generativelanguage.googleapis.com/v1beta/models?key=${key}`;
                const res = await fetch(listUrl);
                const data = await res.json();
                
                if(!res.ok) throw new Error(data.error.message);

                const models = data.models.map(m => m.name.split('/')[1]);
                log(`âœ… åµæ¸¬åˆ°æ‚¨çš„å¸³è™Ÿæ”¯æ´ä»¥ä¸‹æ¨¡å‹: \n${models.join(', ')}`, "#4ecca3");

// ç¬¬äºŒæ­¥ï¼šé–å®š 2.0 ä¸¦ä½¿ç”¨æ­£å¼è«‹æ±‚æ ¼å¼
                const targetModel = "gemini-2.0-flash";
                log(`ğŸ¯ æ­£å¼é€šè¨Šè«‹æ±‚: ${targetModel}`);

                const pingUrl = `https://generativelanguage.googleapis.com/v1beta/models/${targetModel}:generateContent?key=${key}`;
                
                // é§­å®¢ç­†è¨˜ï¼šä¸è¦åªçµ¦ "ping"ï¼Œè¦çµ¦å®ƒä¸€å€‹æ­£å¼çš„æŒ‡ä»¤æ¶æ§‹
                const payload = {
                    contents: [{
                        parts: [{ text: "ä½ å¥½ï¼Œè«‹ç¢ºèªé€£ç·šæˆåŠŸï¼Œä¸¦ç°¡çŸ­è‡ªæˆ‘ä»‹ç´¹ç‚ºã€çµ±å¸¥æŒ‡æ®ä¸­å¿ƒæ ¸å¿ƒå¤§è…¦ã€ã€‚" }]
                    }]
                };

                const pingRes = await fetch(pingUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await pingRes.json();

                if(pingRes.ok) {
                    const aiResponse = data.candidates[0].content.parts[0].text;
                    log(`ğŸŸ¢ é€£ç·šæˆåŠŸï¼å¤§è…¦å›æ‡‰ï¼š${aiResponse}`, "#4ecca3");
                } else {
                    // é€™è£¡æˆ‘åŠ å…¥äº†æ·±å±¤éŒ¯èª¤è¨ºæ–·ï¼Œå®ƒæœƒå‘Šè¨´æˆ‘å€‘æ˜¯ Key æ¬Šé™å•é¡Œé‚„æ˜¯æ¨¡å‹è¢«é–
                    log(`ğŸ”´ æ¡æ‰‹å¤±æ•—: ${data.error.message} (éŒ¯èª¤ç¢¼: ${data.error.status})`, "red");
                }
